<style>
    .global-section {
        background: #262626;
        padding: 80px 0;
        position: relative;
    }

    .global-header {
        text-align: center;
        margin-bottom: 60px;
        padding: 0 5%;
    }

    .global-header h2 {
        font-family: 'Michroma', sans-serif;
        font-size: clamp(2rem, 4vw, 3rem);
        color: var(--mce-sepia-tan);
        margin-bottom: 20px;
        letter-spacing: 0.05em;
        position: relative;
        display: inline-block;
    }

    .global-header h2::after {
        content: '';
        position: absolute;
        bottom: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 2px;
        background: var(--mce-dark-red);
    }

    .global-header h6 {
        font-family: 'Outfit', sans-serif;
        font-weight: 300;
        font-size: clamp(1rem, 2vw, 1.2rem);
        color: #cccccc;
        line-height: 1.6;
    }

    .map-container {
        width: 100%;
        height: 600px;
        position: relative;
    }

    #globalMap {
        width: 100%;
        height: 100%;
    }

    /* Leaflet attribution styling */
    .leaflet-control-attribution {
        background: rgba(0, 0, 0, 0.7) !important;
        color: #999 !important;
        font-size: 10px !important;
    }

    .leaflet-control-attribution a {
        color: var(--mce-sepia-tan) !important;
    }

    @media (max-width: 768px) {
        .global-section {
            padding: 60px 0;
        }

        .global-header {
            margin-bottom: 40px;
        }

        .map-container {
            height: 400px;
        }
    }

    @media (max-width: 480px) {
        .map-container {
            height: 300px;
        }
    }
</style>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

<div class="global-section">
    <div class="global-header">
        <h2>Worldwide Presence</h2>
        <h6>Our products and services reach customers across the globe</h6>
    </div>

    <div class="map-container">
        <div id="globalMap"></div>
    </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script>
    // Wait for Leaflet to be fully loaded
    function initializeGlobalMap() {
        // Check if Leaflet is loaded
        if (typeof L === 'undefined') {
            console.log('Waiting for Leaflet to load...');
            setTimeout(initializeGlobalMap, 100);
            return;
        }

        // Initialize the map
        const map = L.map('globalMap', {
            center: [20, 0], // Center of the world
            zoom: 2,
            minZoom: 2,
            maxZoom: 2,
            zoomControl: false,
            scrollWheelZoom: false, // Disable scroll wheel zoom
            doubleClickZoom: false, // Disable double-click zoom
            touchZoom: false, // Disable touch zoom
            dragging: false, // Disable map dragging/panning
            boxZoom: false, // Disable box zoom
            keyboard: false, // Disable keyboard navigation
        });

        // Add CartoDB Dark Matter tile layer
        const CartoDB_DarkMatterNoLabels = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png', {
            // attribution: '&copy; <a href="https://www. .openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 20
        });

        // Add the tile layer to the map
        CartoDB_DarkMatterNoLabels.addTo(map);

        // Predetermined locations array
        const locations = [
            { lat: 56.1304, lng: -106.3468, name: "Canada" },
            { lat: 37.0902, lng: -95.7129, name: "United States" },
            { lat: 64.2008, lng: -149.4937, name: "Alaska, USA" },
            { lat: 19.8968, lng: -155.5828, name: "Hawaii, USA" },
            { lat: 20.5937, lng: 78.9629, name: "India" },
            { lat: 35.8617, lng: 104.1954, name: "China" }
        ];

        // Custom icon using company colors
        const customIcon = L.divIcon({
            className: 'custom-marker',
            html: `
                <div class="marker-pin"></div>
            `,
            iconSize: [30, 30],
            iconAnchor: [15, 15]
        });

        // Add CSS for custom markers
        const style = document.createElement('style');
        style.textContent = `
            .custom-marker {
                background: transparent;
                border: none;
            }
            
            .marker-pin {
                position: relative;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: #810305;
                border: 3px solid #D4AF85;
                cursor: pointer;
                animation: markerFadeIn 0.6s ease-out forwards, redPulse 2s ease-out infinite;
            }
            
            .marker-pin:hover {
                animation: markerFadeIn 0.6s ease-out forwards, redPulse 2s ease-out infinite, markerHover 0.3s ease forwards;
            }
            
            @keyframes markerFadeIn {
                from {
                    opacity: 0;
                    transform: scale(0);
                }
                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }
            
            @keyframes redPulse {
                0% { 
                    box-shadow: 0 0 0 0 rgba(129, 3, 5, 0.7), 0 0 20px rgba(129, 3, 5, 0.6); 
                }
                25% { 
                    box-shadow: 0 0 0 10px rgba(129, 3, 5, 0.5), 0 0 20px rgba(129, 3, 5, 0.6); 
                }
                50% { 
                    box-shadow: 0 0 0 20px rgba(129, 3, 5, 0.3), 0 0 20px rgba(129, 3, 5, 0.6); 
                }
                75% { 
                    box-shadow: 0 0 0 30px rgba(129, 3, 5, 0.1), 0 0 20px rgba(129, 3, 5, 0.6); 
                }
                100% { 
                    box-shadow: 0 0 0 40px rgba(129, 3, 5, 0), 0 0 20px rgba(129, 3, 5, 0.6); 
                }
            }
            
            @keyframes markerHover {
                to {
                    transform: scale(1.3);
                    box-shadow: 0 0 30px rgba(212, 175, 133, 0.8);
                }
            }
            
            .leaflet-popup-content-wrapper {
                background: transparent;
                border: none;
                box-shadow: none;
            }
            
            .leaflet-popup-content {
                margin: 0;
                color: #D4AF85;
                font-family: 'Outfit', sans-serif;
                font-size: 14px;
                font-weight: 400;
                text-align: center;
            }
            
            .leaflet-popup-tip {
                display: none;
            }
            
            .leaflet-popup-close-button {
                display: none;
            }
        `;
        document.head.appendChild(style);

        // Add markers to the map with staggered animation
        locations.forEach((location, index) => {
            setTimeout(() => {
                const marker = L.marker([location.lat, location.lng], {
                    icon: customIcon
                }).addTo(map);

                // Create popup content - just the name in tan
                const popupContent = location.name;

                marker.bindPopup(popupContent, {
                    maxWidth: 250,
                    className: 'custom-popup',
                    closeButton: false,
                    offset: [0, -5]
                });

                // Open popup on hover (optional)
                marker.on('mouseover', function () {
                    this.openPopup();
                });

            }, index * 200); // Stagger by 200ms
        });

        console.log('Map initialized successfully with', locations.length, 'locations');
    }

    // Start initialization when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeGlobalMap);
    } else {
        initializeGlobalMap();
    }
</script>
