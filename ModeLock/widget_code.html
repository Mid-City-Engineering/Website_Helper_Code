<script>
    (async () => {
        /* For all html tags whose IDs
        start with "modelock-" && End with "-widget",
        Immediately add a CSS style to hide all 
        content until JS is fully loaded */
        const hideCSS = document.createElement('style');
        hideCSS.textContent = `
            [id^="modelock-"][id$="-widget"] {
                opacity: 0;
                transition: opacity 0.3s ease-in;
            }
            body.js-ready [id^="modelock-"][id$="-widget"] {
                opacity: 1;
            }
        `;
        document.head.appendChild(hideCSS);

        // Load the base & universal styles
        const response = await fetch('https://raw.githack.com/Mid-City-Engineering/Website_Helper_Code/main/ModeLock/html/00-base-styles.html');
        const html = await response.text();
        document.head.insertAdjacentHTML('beforeend', html);

        // Individual widget code to load along with github link. Order matters.
        // These will be placed just BEFORE the footer tag
        const widgets = [
            { id: 'modelock-hero-widget', htmlUrl: 'https://raw.githack.com/Mid-City-Engineering/Website_Helper_Code/main/ModeLock/html/01-hero.html' },
            { id: 'modelock-problem-widget', htmlUrl: 'https://raw.githack.com/Mid-City-Engineering/Website_Helper_Code/main/ModeLock/html/02-problem.html' },
            { id: 'modelock-solution-widget', htmlUrl: 'https://raw.githack.com/Mid-City-Engineering/Website_Helper_Code/main/ModeLock/html/03-solution.html' },
            { id: 'modelock-specs-widget', htmlUrl: 'https://raw.githack.com/Mid-City-Engineering/Website_Helper_Code/main/ModeLock/html/04-specs.html' },
            { id: 'modelock-cta-widget', htmlUrl: 'https://raw.githack.com/Mid-City-Engineering/Website_Helper_Code/main/ModeLock/html/05-cta.html' },
        ];

        // Find the footer
        const footer = document.querySelector('footer');

        // For each widget, create and place BEFORE footer, then load content
        const htmlPromises = widgets.map(async ({ id, htmlUrl }) => {
            const div = document.createElement('div');
            div.id = id;
            if (footer) {
                footer.parentNode.insertBefore(div, footer);
            } else {
                document.body.appendChild(div);
            }
            const html = await fetch(htmlUrl).then(r => r.text());
            div.innerHTML = html;
        });

        // Wait for all HTML to be in place
        try {
            await Promise.all(htmlPromises);
        } catch (error) {
            console.error('Failed to load HTML sections:', error);
            // Still show content even if some sections fail
            document.body.classList.add('js-ready');
        }

        // Now load all JS files
        // Note that js comes after html as some js references html elements
        const scripts = [
            'https://raw.githack.com/Mid-City-Engineering/Website_Helper_Code/main/ModeLock/js/fade-in-on-scroll.js',
            'https://raw.githack.com/Mid-City-Engineering/Website_Helper_Code/main/ModeLock/js/mode-animation.js',
            'https://raw.githack.com/Mid-City-Engineering/Website_Helper_Code/main/ModeLock/js/parallax.js',
            'https://raw.githack.com/Mid-City-Engineering/Website_Helper_Code/main/ModeLock/js/smooth-scroll.js'
        ];

        for (const src of scripts) {
            await new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.onload = resolve;
                script.onerror = reject;
                document.body.appendChild(script);
            });
        }

        // All JS loaded - show content with fade-in
        document.body.classList.add('js-ready');
    })();
</script>
