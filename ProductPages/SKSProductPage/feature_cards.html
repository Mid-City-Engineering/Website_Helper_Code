<style>
    @import url('https://fonts.googleapis.com/css2?family=Michroma&family=Inter:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600&display=swap');

    /* Mid City Engineering Design System Variables */
    :root {
        --background: 0 0% 100%;
        --foreground: 0 3% 8%;
        --card: 0 0% 100%;
        --card-foreground: 0 3% 8%;
        --primary: 359 97% 26%;
        --primary-foreground: 0 0% 100%;
        --secondary: 34 30% 88%;
        --muted-foreground: 0 3% 35%;
        /* Darkened from 45% to 35% for better contrast */
        --tan-light: 34 40% 88%;
        --tan-dark: 34 35% 78%;
        --red-glow: 359 97% 26%;
        --radius: 0.5rem;
    }

    h1,
    h2,
    h3 {
        font-family: 'Michroma', sans-serif;
        font-weight: 900;
    }

    .dark {
        --background: 0 3% 8%;
        --foreground: 0 0% 95%;
        --card: 0 3% 12%;
        --card-foreground: 0 0% 95%;
        --primary: 359 85% 45%;
        --muted-foreground: 0 0% 75%;
        /* Lightened from 65% to 75% for better contrast */
        --tan-light: 34 20% 18%;
        --tan-dark: 34 15% 15%;
    }

    /* Screen reader only class */
    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
    }

    /* Feature Highlights Section */
    .feature-highlights {
        padding: 2rem 1.5rem;
    }

    .feature-highlights .container {
        max-width: 100%;
        margin: 0 auto;
    }

    .features-heading {
        font-family: 'Michroma', sans-serif;
        font-weight: 900;
        font-size: 1.5rem;
        margin-bottom: 2rem;
        text-align: center;
        color: hsl(var(--foreground));
    }

    .features-flex {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        justify-content: center;
    }

    .feature-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        padding: 1.5rem;
        border-radius: 0.75rem;
        background: linear-gradient(135deg,
                hsl(var(--tan-light)) 0%,
                hsl(var(--tan-dark)) 100%);
        box-shadow:
            0 4px 20px -4px hsl(var(--primary) / 0.15),
            0 12px 40px -8px hsl(var(--foreground) / 0.1);
        transition: all 0.3s ease;
        opacity: 0;
        animation: slideUp 0.6s ease-out forwards;
        will-change: transform;
        border: 2px solid transparent;
        /* Width will be set dynamically by JavaScript */
        min-width: 140px;
    }

    /* Remove all the @media queries for responsive card sizing */

    .feature-card:focus {
        outline: 3px solid hsl(var(--primary));
        outline-offset: 2px;
        border-color: hsl(var(--primary));
    }

    .feature-card:hover,
    .feature-card:focus-visible {
        box-shadow: 0 0 40px hsl(var(--red-glow) / 0.25);
        transform: translateY(-5px) !important;
    }

    .icon-container {
        width: 4rem;
        height: 4rem;
        border-radius: 50%;
        background: hsl(var(--primary) / 0.1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: hsl(var(--primary));
        margin-bottom: 1rem;
        transition: all 0.3s ease;
    }

    .feature-card:hover .icon-container,
    .feature-card:focus-visible .icon-container {
        background: hsl(var(--primary));
        color: hsl(var(--primary-foreground));
    }

    .icon-container svg {
        width: 2rem;
        height: 2rem;
    }

    .feature-title {
        font-weight: 600;
        color: hsl(var(--foreground));
        font-size: 0.875rem;
        margin-bottom: 0.25rem;
        font-family: 'Inter', sans-serif;
    }

    .feature-description {
        color: hsl(var(--muted-foreground));
        font-size: 0.75rem;
        line-height: 1.4;
        font-family: 'Outfit', -apple-system, sans-serif;
    }

    /* Animations */
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Reduced motion preferences */
    @media (prefers-reduced-motion: reduce) {
        .feature-card {
            animation: none;
            opacity: 1;
            transform: none !important;
        }

        .feature-card,
        .icon-container {
            transition: none;
        }

        .feature-card:hover,
        .feature-card:focus-visible {
            transform: none !important;
        }
    }

    /* Responsive Design - Always 2 or 4 cards per row */
    /* Mobile: 2 cards per row */
    @media (min-width: 480px) {}

    /* Tablet and up: 4 cards per row */
    @media (min-width: 768px) {}

    /* Large screens: maintain 4 cards per row with max-width constraint */
    @media (min-width: 1200px) {
        .features-flex {
            max-width: 1200px;
            margin: 0 auto;
        }
    }

    /* High contrast mode support */
    @media (prefers-contrast: high) {
        .feature-card {
            border: 2px solid currentColor;
        }

        .feature-card:focus {
            outline-width: 4px;
        }
    }
</style>

<section class="feature-highlights" role="region" aria-labelledby="features-heading">
    <div class="container">
        <h2 id="features-heading" class="sr-only">Key Features</h2>
        <div class="features-flex" id="featuresGrid" role="list">
            <!-- Features will be dynamically inserted here -->
        </div>
    </div>
</section>

<script>
    (function () {
        'use strict';

        // Lucide icon SVG strings with aria-hidden
        const icons = {
            shield: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/></svg>`,

            zap: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><path d="M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z"/></svg>`,

            smartphone: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>`,

            car: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2"/><circle cx="7" cy="17" r="2"/><path d="M9 17h6"/><circle cx="17" cy="17" r="2"/></svg>`,

            wrench: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>`,

            award: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" focusable="false"><path d="m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526"/><circle cx="12" cy="8" r="6"/></svg>`
        };

        // Default features data
        const defaultFeatures = [
            {
                icon: 'shield',
                title: 'OEM Integration',
                description: 'Seamless factory system integration'
            },
            {
                icon: 'zap',
                title: 'Instant Response',
                description: 'Lightning-fast activation'
            },
            {
                icon: 'smartphone',
                title: 'Smartphone Ready',
                description: 'Control from anywhere'
            },
            {
                icon: 'car',
                title: 'Vehicle Specific',
                description: 'Precision-engineered harness'
            }
        ];

        // Function to create feature card HTML
        function createFeatureCard(feature, index) {
            const card = document.createElement('div');
            card.className = 'feature-card';
            card.setAttribute('role', 'listitem');
            card.setAttribute('tabindex', '0');
            card.style.animationDelay = `${index * 0.1}s`;

            // Create accessible label for screen readers
            const accessibleLabel = feature.description
                ? `${feature.title}: ${feature.description}`
                : feature.title;
            card.setAttribute('aria-label', accessibleLabel);

            card.innerHTML = `
                <div class="icon-container" aria-hidden="true">
                    ${icons[feature.icon]}
                </div>
                <h3 class="feature-title">${feature.title}</h3>
                ${feature.description ? `<p class="feature-description">${feature.description}</p>` : ''}
            `;

            return card;
        }

        // Function to render features
        function renderFeatures(features) {
            features = features || defaultFeatures;
            const grid = document.getElementById('featuresGrid');

            if (!grid) {
                console.error('Features grid element not found');
                return;
            }

            // Clear existing content
            grid.innerHTML = '';

            features.forEach(function (feature, index) {
                const card = createFeatureCard(feature, index);
                grid.appendChild(card);
            });

            // Announce to screen readers that content has loaded
            const announcement = document.createElement('div');
            announcement.className = 'sr-only';
            announcement.setAttribute('role', 'status');
            announcement.setAttribute('aria-live', 'polite');
            announcement.textContent = `${features.length} features loaded`;
            grid.appendChild(announcement);

            // Adjust layout based on container width
            adjustLayout();
        }

        function adjustLayout() {
            const grid = document.getElementById('featuresGrid');
            if (!grid) return;

            const containerWidth = grid.offsetWidth;
            const cards = grid.querySelectorAll('.feature-card');
            const gap = 24; // 1.5rem in pixels
            const minCardWidth = 140;
            const maxCardWidth = 280;

            // Calculate how many cards can fit
            // Account for gaps: n cards need (n-1) gaps
            const canFit4 = (containerWidth >= (minCardWidth * 4 + gap * 3));
            const canFit2 = (containerWidth >= (minCardWidth * 2 + gap));

            let cardWidth;

            if (canFit4) {
                // 4 cards per row
                cardWidth = Math.min((containerWidth - gap * 3) / 4, maxCardWidth);
            } else if (canFit2) {
                // 2 cards per row
                cardWidth = Math.min((containerWidth - gap) / 2, maxCardWidth);
            } else {
                // 1 card per row (stack vertically)
                cardWidth = Math.min(containerWidth, maxCardWidth);
            }

            // Apply calculated width to all cards
            cards.forEach(function (card) {
                if (card.classList.contains('sr-only')) return; // Skip announcement div
                card.style.flex = `0 0 ${cardWidth}px`;
                card.style.maxWidth = `${cardWidth}px`;
            });
        }

        // Re-adjust on window resize
        let resizeTimer;
        window.addEventListener('resize', function () {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function () {
                adjustLayout();
            }, 250);
        });

        // Initialize on DOM load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function () {
                renderFeatures();
            });
        } else {
            // DOM already loaded
            renderFeatures();
        }
    })();
</script>
