<!-- Google Tag Manager -->
<script>(function (w, d, s, l, i) {
        w[l] = w[l] || []; w[l].push({
            'gtm.start':
                new Date().getTime(), event: 'gtm.js'
        }); var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-NRV5LH9Z');</script>
<!-- End Google Tag Manager -->

<!-- When navigating to ids in another page, scroll to top before jumping to hash anchor -->
<script>
    (function () {
        if (window.location.hash) {
            var targetId = window.location.hash.substring(1);

            // Temporarily remove the id so the browser can't auto-scroll to it
            document.addEventListener('DOMContentLoaded', function () {
                var target = document.getElementById(targetId);
                if (target) {
                    var originalId = target.id;
                    target.id = '__temp_disabled__';

                    window.scrollTo(0, 0);

                    setTimeout(function () {
                        target.id = originalId;
                        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 300);
                }
            });
        }
    })();
</script>
<!-- End of script for starting at top upon page change -->

<!-- Script to set up smooth scrolling for on-page anchor clicks -->
<script>
    (function () {
        function initSmoothScroll() {
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    const targetId = this.getAttribute('href');

                    // Skip if it's just "#" or empty
                    if (!targetId || targetId === '#') return;

                    // ADDED: Skip if it's a full URL (contains ://)
                    if (targetId.includes('://')) {
                        console.log('[Smooth Scroll] Skipping full URL:', targetId);
                        return;
                    }

                    // ADDED: Validate it's a proper hash selector
                    if (!targetId.startsWith('#')) {
                        console.log('[Smooth Scroll] Skipping non-hash link:', targetId);
                        return;
                    }

                    // ADDED: Try-catch around querySelector in case of invalid selector
                    let targetElement;
                    try {
                        targetElement = document.querySelector(targetId);
                    } catch (error) {
                        console.log('[Smooth Scroll] Invalid selector:', targetId, error);
                        return;
                    }

                    // Handle #top as a special case
                    if (targetId === '#top') {
                        e.preventDefault();
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                        return;
                    }

                    if (targetElement) {
                        e.preventDefault();

                        // Close hamburger menu if open
                        const drawer = document.getElementById('hamburgerDrawer');
                        const hamburger = document.querySelector('.hamburger');
                        if (drawer && drawer.classList.contains('active')) {
                            if (hamburger) { hamburger.classList.remove('active'); }
                            drawer.classList.remove('active');
                        }

                        // Smooth scroll to target
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        }

        // Initialize smooth scroll when DOM is fully loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initSmoothScroll);
        } else {
            // DOM already loaded (script runs after page load)
            initSmoothScroll();
        }
    })();
</script>
<!-- End smooth scrolling script -->
